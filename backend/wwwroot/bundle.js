var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(var n in t)e[n]=t[n];return e}function r(e){return e()}function o(){return Object.create(null)}function i(e){e.forEach(r)}function s(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e,t,n){e.$$.on_destroy.push(t.subscribe(n))}const u=new Set;let l,h,p=!1;function f(){u.forEach(e=>{e[0](window.performance.now())||(u.delete(e),e[1]())}),(p=u.size>0)&&requestAnimationFrame(f)}function g(e,t){e.appendChild(t)}function d(e,t,n){e.insertBefore(t,n)}function m(e){e.parentNode.removeChild(e)}function v(e,t){for(var n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function b(e){return document.createElement(e)}function y(e){return document.createTextNode(e)}function w(){return document.createComment("")}function S(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function x(e,t){e.data=""+t}function T(e,t,n){e.style.setProperty(t,n)}function k(e,t,n){e.classList[n?"add":"remove"](t)}function $(){l={remaining:0,callbacks:[]}}function C(){l.remaining||i(l.callbacks)}function P(e){l.callbacks.push(e)}function E(e){h=e}let I,_=[];const R=[],j=[];function O(e){j.push(e)}function N(e){R.push(e)}function W(){const e=new Set;do{for(;_.length;){const e=_.shift();E(e),M(e.$$)}for(;R.length;)R.shift()();for(;j.length;){const t=j.pop();e.has(t)||(t(),e.add(t))}}while(_.length);I=null}function M(e){e.fragment&&(e.update(e.dirty),i(e.before_render),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_render.forEach(O))}function A(e,t){var r,o=t.token={};function i(e,r,i,s){if(t.token!==o)return;t.resolved=i&&{[i]:s};const c=n(n({},t.ctx),t.resolved),a=e&&(t.current=e)(c);t.block&&(t.blocks?t.blocks.forEach((e,n)=>{n!==r&&e&&($(),P(()=>{e.d(1),t.blocks[n]=null}),e.o(1),C())}):t.block.d(1),a.c(),a.i&&a.i(1),a.m(t.mount(),t.anchor),W()),t.block=a,t.blocks&&(t.blocks[r]=a)}if((r=e)&&"function"==typeof r.then){if(e.then(e=>{i(t.then,1,t.value,e)},e=>{i(t.catch,2,t.error,e)}),t.current!==t.pending)return i(t.pending,0),!0}else{if(t.current!==t.then)return i(t.then,1,t.value,e),!0;t.resolved={[t.value]:e}}}function q(e,t,n){const{fragment:o,on_mount:c,on_destroy:a,after_render:u}=e.$$;o.m(t,n),O(()=>{const t=c.map(r).filter(s);a?a.push(...t):i(t),e.$$.on_mount=[]}),u.forEach(O)}function H(e,t){e.$$.dirty||(_.push(e),I||(I=Promise.resolve()).then(W),e.$$.dirty={}),e.$$.dirty[t]=!0}function U(t,n,r,s,c){const a=h;E(t);const u=n.props||{},l=t.$$={fragment:null,ctx:null,update:e,not_equal:c,bound:o(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(a?a.$$.context:[]),callbacks:o(),dirty:null};let p=!1;var f;l.ctx=r?r(t,u,(e,n)=>{if(l.bound[e]&&l.bound[e](n),l.ctx){const r=c(n,l.ctx[e]);return p&&r&&H(t,e),l.ctx[e]=n,r}}):u,l.update(),p=!0,i(l.before_render),l.fragment=s(l.ctx),n.target&&(n.hydrate?l.fragment.l((f=n.target,Array.from(f.childNodes))):l.fragment.c(),n.intro&&t.$$.fragment.i&&t.$$.fragment.i(),q(t,n.target,n.anchor),W()),E(a)}class L{$destroy(){var t,n;n=!0,(t=this).$$&&(i(t.$$.on_destroy),t.$$.fragment.d(n),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={}),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function F(e){var t,n,r,o,i,s,c,a,u,l,h,p,f,v,w,S,T,k,$,C,P,E,I,_,R,j,O,N,W,M,A,q,H,U,L=e.textToWrite.slice(e.matchingPrefix.length),F=e.writtenText.slice(e.matchingPrefix.length);return{c(){t=b("div"),n=y("WrittenText: "),r=b("span"),o=y('"'),i=y(e.writtenText),s=y('"'),c=y("\n"),a=b("div"),u=y("Matching Prefix: "),l=b("span"),h=y('"'),p=y(e.matchingPrefix),f=y('"'),v=y("\n"),w=b("div"),S=y("Rest: "),T=b("span"),k=y('"'),$=y(L),C=y('"'),P=y("\n"),E=b("div"),I=y("Wrong letters: "),_=b("span"),R=y('"'),j=y(F),O=y('"'),N=y("\n"),W=b("div"),M=y("no errors: "),A=b("span"),q=y('"'),H=y(e.numberOfErrors),U=y('"'),r.className="svelte-m8oud8",l.className="svelte-m8oud8",T.className="svelte-m8oud8",_.className="svelte-m8oud8",A.className="svelte-m8oud8"},m(e,m){d(e,t,m),g(t,n),g(t,r),g(r,o),g(r,i),g(r,s),d(e,c,m),d(e,a,m),g(a,u),g(a,l),g(l,h),g(l,p),g(l,f),d(e,v,m),d(e,w,m),g(w,S),g(w,T),g(T,k),g(T,$),g(T,C),d(e,P,m),d(e,E,m),g(E,I),g(E,_),g(_,R),g(_,j),g(_,O),d(e,N,m),d(e,W,m),g(W,M),g(W,A),g(A,q),g(A,H),g(A,U)},p(e,t){e.writtenText&&x(i,t.writtenText),e.matchingPrefix&&x(p,t.matchingPrefix),(e.textToWrite||e.matchingPrefix)&&L!==(L=t.textToWrite.slice(t.matchingPrefix.length))&&x($,L),(e.writtenText||e.matchingPrefix)&&F!==(F=t.writtenText.slice(t.matchingPrefix.length))&&x(j,F),e.numberOfErrors&&x(H,t.numberOfErrors)},d(e){e&&(m(t),m(c),m(a),m(v),m(w),m(P),m(E),m(N),m(W))}}}function D(t){var n,r,o,i,s,c,a,u,l,h=t.debug&&F(t);return{c(){n=b("div"),r=b("span"),o=y(t.matchingPrefix),i=b("span"),s=y(t.errorPart),c=b("span"),a=y(t.remainingPart),u=y("\n"),h&&h.c(),l=w(),r.className="correct svelte-m8oud8",i.className="incorrect svelte-m8oud8",c.className="svelte-m8oud8"},m(e,t){d(e,n,t),g(n,r),g(r,o),g(n,i),g(i,s),g(n,c),g(c,a),d(e,u,t),h&&h.m(e,t),d(e,l,t)},p(e,t){e.matchingPrefix&&x(o,t.matchingPrefix),e.errorPart&&x(s,t.errorPart),e.remainingPart&&x(a,t.remainingPart),t.debug?h?h.p(e,t):((h=F(t)).c(),h.m(l.parentNode,l)):h&&(h.d(1),h=null)},i:e,o:e,d(e){e&&(m(n),m(u)),h&&h.d(e),e&&m(l)}}}function G(e,t,n){let r,o,i,s,{textToWrite:c="Populate the textToWrite prop to insert your own text to write!",writtenText:a="",debug:u=!1}=t;return e.$set=(e=>{"textToWrite"in e&&n("textToWrite",c=e.textToWrite),"writtenText"in e&&n("writtenText",a=e.writtenText),"debug"in e&&n("debug",u=e.debug)}),e.$$.update=((e={writtenText:1,textToWrite:1,matchingPrefix:1,numberOfErrors:1})=>{(e.writtenText||e.textToWrite)&&(r=function(e,t){for(let n=e.length;n>0;n--){let r=e.slice(0,n);if(r===t.slice(0,n))return r}return""}(a,c),n("matchingPrefix",r)),(e.writtenText||e.matchingPrefix)&&(o=a.length-r.length,n("numberOfErrors",o)),(e.textToWrite||e.matchingPrefix||e.numberOfErrors)&&(i=c.slice(r.length,r.length+o),n("errorPart",i)),(e.textToWrite||e.matchingPrefix||e.numberOfErrors)&&(s=c.slice(r.length+o),n("remainingPart",s))}),{textToWrite:c,writtenText:a,debug:u,matchingPrefix:r,numberOfErrors:o,errorPart:i,remainingPart:s}}class B extends L{constructor(e){super(),U(this,e,G,D,c)}get textToWrite(){return this.$$.ctx.textToWrite}set textToWrite(e){this.$set({textToWrite:e}),W()}get writtenText(){return this.$$.ctx.writtenText}set writtenText(e){this.$set({writtenText:e}),W()}get debug(){return this.$$.ctx.debug}set debug(e){this.$set({debug:e}),W()}}function K(e){var t,n,r,o,s,c,a,u,l,h,p=new B({props:{textToWrite:e.currentProblem,writtenText:e.writtenText}}),f=""===e.remainingText&&z(e),v=Y;return{c(){var i,l,g;p.$$.fragment.c(),t=y("\n\t"),n=b("br"),r=y("\n\t"),o=b("input"),c=y("\n\t"),a=b("div"),f&&f.c(),u=y("\n\t\t"),v&&v.c(),o.autofocus=!0,i=o,l="type",null==(g="text")?i.removeAttribute(l):i.setAttribute(l,g),o.placeholder=s=""===e.confirmedText?`${e.currentProblem.slice(0,10)}...`:"",o.className="svelte-12unudd",h=[S(o,"input",e.input_input_handler),S(o,"input",e.handleInput),S(o,"keyup",e.handleKeyUp)]},m(i,s){q(p,i,s),d(i,t,s),d(i,n,s),d(i,r,s),d(i,o,s),o.value=e.pendingText,d(i,c,s),d(i,a,s),f&&f.m(a,null),g(a,u),v&&v.m(a,null),l=!0,o.focus()},p(e,t){var n={};e.currentProblem&&(n.textToWrite=t.currentProblem),e.writtenText&&(n.writtenText=t.writtenText),p.$set(n),e.pendingText&&(o.value=t.pendingText),l&&!e.confirmedText&&!e.currentProblem||s===(s=""===t.confirmedText?`${t.currentProblem.slice(0,10)}...`:"")||(o.placeholder=s),""===t.remainingText?f||((f=z(t)).c(),f.m(a,u)):f&&(f.d(1),f=null),v&&(v.d(1),v=null)},i(e){l||(p.$$.fragment.i(e),l=!0)},o(e){p.$$.fragment.o(e),l=!1},d(e){p.$destroy(e),e&&(m(t),m(n),m(r),m(o),m(c),m(a)),f&&f.d(),v&&v.d(),i(h)}}}function J(t){var n;return{c(){(n=b("strong")).textContent="Congratulations, you finished the problem set!"},m(e,t){d(e,n,t)},p:e,i:e,o:e,d(e){e&&m(n)}}}function z(e){var t;return{c(){(t=b("div")).textContent="Complete! Hit Return ↵ for another challenge!",t.className="complete svelte-12unudd"},m(e,n){d(e,t,n)},d(e){e&&m(t)}}}function X(e){var t,n,r,o,i=[J,K],s=[];function c(e){return e.setCompleted?0:1}return t=c(e),n=s[t]=i[t](e),{c(){n.c(),r=w()},m(e,n){s[t].m(e,n),d(e,r,n),o=!0},p(e,o){var a=t;(t=c(o))===a?s[t].p(e,o):($(),P(()=>{s[a].d(1),s[a]=null}),n.o(1),C(),(n=s[t])||(n=s[t]=i[t](o)).c(),n.i(1),n.m(r.parentNode,r))},i(e){o||(n&&n.i(),o=!0)},o(e){n&&n.o(),o=!1},d(e){s[t].d(e),e&&m(r)}}}let Y=!1;function V(e,t,n){let r,o,{problemSet:i={name:"Example set",problems:["Example text to write!"]},onprogress:s=(()=>{})}=t,{setProblemIndex:c=function(e){n("currentProblemIndex",a=e)}}=t,a=0,u=i.problems[a],l=u,h="",p="";return e.$set=(e=>{"problemSet"in e&&n("problemSet",i=e.problemSet),"onprogress"in e&&n("onprogress",s=e.onprogress),"setProblemIndex"in e&&n("setProblemIndex",c=e.setProblemIndex)}),e.$$.update=((e={problemSet:1,currentProblemIndex:1,currentProblem:1,confirmedText:1,pendingText:1,remainingText:1})=>{(e.problemSet||e.currentProblemIndex||e.currentProblem)&&(u=i.problems[a],n("currentProblem",u),n("remainingText",l=u),n("confirmedText",h=""),n("pendingText",p="")),(e.confirmedText||e.pendingText)&&n("writtenText",r=`${h}${p}`),(e.currentProblemIndex||e.problemSet||e.remainingText)&&(o=a===i.problems.length-1&&""===l,n("setCompleted",o))}),{problemSet:i,onprogress:s,setProblemIndex:c,currentProblem:u,remainingText:l,confirmedText:h,pendingText:p,handleInput:function(e){const t=p===l;(" "===e.data||t)&&(t||p===l.substring(0,p.length))&&(l=l.slice(p.length),n("remainingText",l),n("confirmedText",h=`${h}${p}`),n("pendingText",p=""),s(h.length/u.length))},handleKeyUp:function(e){"Enter"===e.code&&""===l&&(console.log(o,a,i.problems.length-1),o||n("currentProblemIndex",a+=1))},writtenText:r,setCompleted:o,input_input_handler:function(){p=this.value,n("pendingText",p)}}}class Q extends L{constructor(e){super(),U(this,e,V,X,c)}get problemSet(){return this.$$.ctx.problemSet}set problemSet(e){this.$set({problemSet:e}),W()}get onprogress(){return this.$$.ctx.onprogress}set onprogress(e){this.$set({onprogress:e}),W()}get setProblemIndex(){return this.$$.ctx.setProblemIndex}set setProblemIndex(e){this.$set({setProblemIndex:e}),W()}}function Z(e,t,n){const r=Object.create(e);return r.problemSet=t[n],r.i=n,r}function ee(e){var t,n,r,o=e.problemSet.name;function i(...t){return e.click_handler(e,...t)}return{c(){t=b("a"),n=y(o),t.href="#"+e.problemSet.name,t.className="svelte-1b1yjc9",r=S(t,"click",i)},m(e,r){d(e,t,r),g(t,n)},p(t,n){e=n},d(e){e&&m(t),r()}}}function te(e){for(var t,n,r,o,i,s,c,a,u,l,h=e.problemSets,p=[],f=0;f<h.length;f+=1)p[f]=ee(Z(e,h,f));let w={problemSet:e.currentProblemSet};var S=new Q({props:w});return N(()=>e.practicepad_binding(S)),{c(){t=b("div"),(n=b("h2")).textContent="Welcome to TypeJitsu",r=y("\n\t"),o=b("div");for(var e=0;e<p.length;e+=1)p[e].c();i=y("\n\t"),(s=b("div")).textContent="Type the text below into the text field.",c=y("\n\t"),a=b("hr"),u=y("\n\t"),S.$$.fragment.c(),t.className="main svelte-1b1yjc9"},m(e,h){d(e,t,h),g(t,n),g(t,r),g(t,o);for(var f=0;f<p.length;f+=1)p[f].m(o,null);g(t,i),g(t,s),g(t,c),g(t,a),g(t,u),q(S,t,null),l=!0},p(e,t){if(e.problemSets){h=t.problemSets;for(var n=0;n<h.length;n+=1){const r=Z(t,h,n);p[n]?p[n].p(e,r):(p[n]=ee(r),p[n].c(),p[n].m(o,null))}for(;n<p.length;n+=1)p[n].d(1);p.length=h.length}var r={};e.currentProblemSet&&(r.problemSet=t.currentProblemSet),S.$set(r)},i(e){l||(S.$$.fragment.i(e),l=!0)},o(e){S.$$.fragment.o(e),l=!1},d(n){n&&m(t),v(p,n),e.practicepad_binding(null),S.$destroy()}}}function ne(e,t,n){const r=[{name:"Text",problems:["What a wonderful world!","What is this, magic?"]},{name:"Code",problems:["function(x) { return x; }",'() => { return "Hello, world!"; }']},{name:"Numbers & Symbols",problems:["1820 3949 0695 8231","%*@! <(}! >?|) *@)# []&* =~-\\ /.${"]}];let o,i=r[0];function s(e,t){o.setProblemIndex(0),i=r[t],n("currentProblemSet",i),e.preventDefault()}return{problemSets:r,currentProblemSet:i,practicePad:o,handleClick:s,click_handler:function({i:e},t){return s(t,e)},practicepad_binding:function(e){n("practicePad",o=e)}}}class re extends L{constructor(e){super(),U(this,e,ne,te,c)}}function oe(t,n=e){let r;const o=[];function i(e){if(c(t,e)){if(t=e,!r)return;o.forEach(e=>e[1]()),o.forEach(e=>e[0](t))}}return{set:i,update:function(e){i(e(t))},subscribe:function(i,s=e){const c=[i,s];return o.push(c),1===o.length&&(r=n()||e),i(t),()=>{const e=o.indexOf(c);-1!==e&&o.splice(e,1),0===o.length&&r()}}}}function ie(e){var t=e-1;return t*t*t+1}function se(e){return"[object Date]"===Object.prototype.toString.call(e)}function ce(e,t){if(e===t||e!=e)return()=>e;const n=typeof e;if(n!==typeof t||Array.isArray(e)!==Array.isArray(t))throw new Error("Cannot interpolate values of different type");if(Array.isArray(e)){const n=t.map((t,n)=>ce(e[n],t));return e=>n.map(t=>t(e))}if("object"===n){if(!e||!t)throw new Error("Object cannot be null");if(se(e)&&se(t)){e=e.getTime();const n=(t=t.getTime())-e;return t=>new Date(e+t*n)}const n=Object.keys(t),r={};return n.forEach(n=>{r[n]=ce(e[n],t[n])}),e=>{const t={};return n.forEach(n=>{t[n]=r[n](e)}),t}}if("number"===n){const n=t-e;return t=>e+t*n}throw new Error(`Cannot interpolate ${n} values`)}function ae(e,r={}){const o=oe(e);let i,s=e;function c(c,a){s=c;let l=i,h=!1,{delay:g=0,duration:d=400,easing:m=t,interpolate:v=ce}=n(n({},r),a);const b=window.performance.now()+g;let y;return(i=function(e){let t;return p||(p=!0,requestAnimationFrame(f)),{promise:new Promise(n=>{u.add(t=[e,n])}),abort(){u.delete(t)}}}(t=>{if(t<b)return!0;h||(y=v(e,c),"function"==typeof d&&(d=d(e,c)),h=!0),l&&(l.abort(),l=null);const n=t-b;return n>d?(o.set(e=c),!1):(o.set(e=y(m(n/d))),!0)})).promise}return{set:c,update:(t,n)=>c(t(s,e),n),subscribe:o.subscribe}}function ue(t){var n,r;return{c(){n=b("div"),(r=b("span")).className="completed svelte-wc8jqk",T(r,"width",t.$progressTweened+"%"),n.className="svelte-wc8jqk"},m(e,t){d(e,n,t),g(n,r)},p(e,t){e.$progressTweened&&T(r,"width",t.$progressTweened+"%")},i:e,o:e,d(e){e&&m(n)}}}function le(e,t,n){let r;const o=ae(0,{duration:400,easing:ie});a(e,o,e=>{n("$progressTweened",r=e)});let{progress:i=0}=t;return e.$set=(e=>{"progress"in e&&n("progress",i=e.progress)}),e.$$.update=((e={progress:1})=>{e.progress&&o.set(Math.floor(100*i))}),{progressTweened:o,progress:i,$progressTweened:r}}class he extends L{constructor(e){super(),U(this,e,le,ue,c)}get progress(){return this.$$.ctx.progress}set progress(e){this.$set({progress:e}),W()}}const pe=oe({}),fe=oe({}),ge=oe({});function de(e){var t,n,r,o,i,s,c=e.$nameService[e.user.id]?e.$nameService[e.user.id]:e.user.id,a=me((100*e.user.progress).toFixed(1),5),u=new he({props:{progress:e.user.progress}});return{c(){t=b("div"),n=y(c),r=y(" "),o=y(a),i=y("%\r\n    "),u.$$.fragment.c(),t.className="svelte-11x4rlf",k(t,"me",e.isme)},m(e,c){d(e,t,c),g(t,n),g(t,r),g(t,o),g(t,i),q(u,t,null),s=!0},p(e,r){s&&!e.$nameService&&!e.user||c===(c=r.$nameService[r.user.id]?r.$nameService[r.user.id]:r.user.id)||x(n,c),s&&!e.user||a===(a=me((100*r.user.progress).toFixed(1),5))||x(o,a);var i={};e.user&&(i.progress=r.user.progress),u.$set(i),e.isme&&k(t,"me",r.isme)},i(e){s||(u.$$.fragment.i(e),s=!0)},o(e){u.$$.fragment.o(e),s=!1},d(e){e&&m(t),u.$destroy()}}}function me(e,t){return(e.length<t?Array(t-e.length).join(" "):"")+e}function ve(e,t,n){let r;a(e,fe,e=>{n("$nameService",r=e)});let{user:o={},isme:i=!1}=t;return e.$set=(e=>{"user"in e&&n("user",o=e.user),"isme"in e&&n("isme",i=e.isme)}),{user:o,isme:i,$nameService:r}}class be extends L{constructor(e){super(),U(this,e,ve,de,c)}get user(){return this.$$.ctx.user}set user(e){this.$set({user:e}),W()}get isme(){return this.$$.ctx.isme}set isme(e){this.$set({isme:e}),W()}}function ye(e,t,n){const r=Object.create(e);return r.userKey=t[n],r}function we(t){var n,r,o,i=t.error.message;return{c(){n=b("p"),r=y("Error joining racing group "),o=y(i),T(n,"color","red")},m(e,t){d(e,n,t),g(n,r),g(n,o)},p(e,t){e.joinRaceGroup&&i!==(i=t.error.message)&&x(o,i)},i:e,o:e,d(e){e&&m(n)}}}function Se(e){var t,n,r,o,i;let s={onprogress:e.progressHandler,problemSet:e.currentProblemSet};var c=new Q({props:s});return N(()=>e.practicepad_binding(c)),{c(){(t=b("div")).textContent="Type the text below into the text field.",n=y("\n\t\t"),r=b("hr"),o=y("\n\t\t"),c.$$.fragment.c()},m(e,s){d(e,t,s),d(e,n,s),d(e,r,s),d(e,o,s),q(c,e,s),i=!0},p(e,t){var n={};e.progressHandler&&(n.onprogress=t.progressHandler),e.currentProblemSet&&(n.problemSet=t.currentProblemSet),c.$set(n)},i(e){i||(c.$$.fragment.i(e),i=!0)},o(e){c.$$.fragment.o(e),i=!1},d(i){i&&(m(t),m(n),m(r),m(o)),e.practicepad_binding(null),c.$destroy(i)}}}function xe(t){var n;return{c(){(n=b("p")).textContent="...connecting to racing group"},m(e,t){d(e,n,t)},p:e,i:e,o:e,d(e){e&&m(n)}}}function Te(e){var t,n=new be({props:{isme:e.userKey===e.myId,user:e.$currentUsers[e.userKey]}});return{c(){n.$$.fragment.c()},m(e,r){q(n,e,r),t=!0},p(e,t){var r={};(e.$currentUsers||e.myId)&&(r.isme=t.userKey===t.myId),e.$currentUsers&&(r.user=t.$currentUsers[t.userKey]),n.$set(r)},i(e){t||(n.$$.fragment.i(e),t=!0)},o(e){n.$$.fragment.o(e),t=!1},d(e){n.$destroy(e)}}}function ke(e){var t,r,o,i,s,c,a,u,l,h,p,f,w,S;let T={ctx:e,current:null,pending:xe,then:Se,catch:we,value:"joined",error:"error",blocks:Array(3)};A(u=e.joinRaceGroup,T);for(var k=Object.keys(e.$currentUsers),E=[],I=0;I<k.length;I+=1)E[I]=Te(ye(e,k,I));function _(e,t,n){E[e]&&(t&&P(()=>{E[e].d(t),E[e]=null}),E[e].o(n))}return{c(){t=b("div"),r=b("strong"),o=y("Master status: "),i=y(e.masterStatus),s=y("\n\t"),(c=b("h2")).textContent="🏍️ Welcome to Racing in TypeJitsu",a=y("\n\n\t"),T.block.c(),l=y("\n\n\t"),h=b("hr"),p=y("\n\t"),f=b("div"),w=y("Connected users:\n\t\t");for(var n=0;n<E.length;n+=1)E[n].c();t.className="main svelte-tctpn1"},m(e,n){d(e,t,n),g(t,r),g(r,o),g(r,i),g(t,s),g(t,c),g(t,a),T.block.m(t,T.anchor=null),T.mount=(()=>t),T.anchor=l,g(t,l),g(t,h),g(t,p),g(t,f),g(f,w);for(var u=0;u<E.length;u+=1)E[u].m(f,null);S=!0},p(t,r){if(e=r,S&&!t.masterStatus||x(i,e.masterStatus),T.ctx=e,"joinRaceGroup"in t&&u!==(u=e.joinRaceGroup)&&A(u,T)||T.block.p(t,n(n({},e),T.resolved)),t.$currentUsers||t.myId){k=Object.keys(e.$currentUsers);for(var o=0;o<k.length;o+=1){const n=ye(e,k,o);E[o]?(E[o].p(t,n),E[o].i(1)):(E[o]=Te(n),E[o].c(),E[o].i(1),E[o].m(f,null))}for($();o<E.length;o+=1)_(o,1,1);C()}},i(e){if(!S){T.block.i();for(var t=0;t<k.length;t+=1)E[t].i();S=!0}},o(e){for(let e=0;e<3;e+=1){const t=T.blocks[e];t&&t.o()}E=E.filter(Boolean);for(let e=0;e<E.length;e+=1)_(e,0);S=!1},d(e){e&&m(t),T.block.d(),T=null,v(E,e)}}}function $e(e,t,n){let r;a(e,pe,e=>{n("$currentUsers",r=e)});let{racingGroup:o="defaultRaceGroup",signalrConnection:i,myId:s="",masterStatus:c=!1}=t;let u,l=[{name:"Text",problems:["What a wonderful world! A world where you can type and type as you wonder: What does it all mean? Let the letters flow through your fingertips, your fingers like little spiders on the keyboard.","What is this, magic? That is the question everyone is asking themselves, is it really magic or is it just a little bit of good luck and some SignalR?"]},{name:"Code",problems:["function(x) { return x; }",'() => { return "Hello, world!"; }']},{name:"Numbers & Symbols",problems:["1820 3949 0695 8231","%*@! <(}! >?|) *@)# []&* =~-\\ /.${"]}][0],{joinRaceGroup:h}=t;return e.$set=(e=>{"racingGroup"in e&&n("racingGroup",o=e.racingGroup),"signalrConnection"in e&&n("signalrConnection",i=e.signalrConnection),"myId"in e&&n("myId",s=e.myId),"masterStatus"in e&&n("masterStatus",c=e.masterStatus),"joinRaceGroup"in e&&n("joinRaceGroup",h=e.joinRaceGroup)}),{racingGroup:o,signalrConnection:i,myId:s,masterStatus:c,currentProblemSet:l,practicePad:u,joinRaceGroup:h,progressHandler:function(e){i().then(t=>t.invoke("Progress",o,e))},$currentUsers:r,practicepad_binding:function(e){n("practicePad",u=e)}}}class Ce extends L{constructor(e){super(),U(this,e,$e,ke,c)}get racingGroup(){return this.$$.ctx.racingGroup}set racingGroup(e){this.$set({racingGroup:e}),W()}get signalrConnection(){return this.$$.ctx.signalrConnection}set signalrConnection(e){this.$set({signalrConnection:e}),W()}get myId(){return this.$$.ctx.myId}set myId(e){this.$set({myId:e}),W()}get masterStatus(){return this.$$.ctx.masterStatus}set masterStatus(e){this.$set({masterStatus:e}),W()}get joinRaceGroup(){return this.$$.ctx.joinRaceGroup}set joinRaceGroup(e){this.$set({joinRaceGroup:e}),W()}}var Pe,Ee,Ie=(Pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}Pe(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),_e=function(e){function t(t,n){var r=this,o=this.constructor.prototype;return(r=e.call(this,t)||this).statusCode=n,r.__proto__=o,r}return Ie(t,e),t}(Error),Re=function(e){function t(t){void 0===t&&(t="A timeout occurred.");var n=this,r=this.constructor.prototype;return(n=e.call(this,t)||this).__proto__=r,n}return Ie(t,e),t}(Error),je=function(e){function t(t){void 0===t&&(t="An abort occurred.");var n=this,r=this.constructor.prototype;return(n=e.call(this,t)||this).__proto__=r,n}return Ie(t,e),t}(Error),Oe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ne=function(){return function(e,t,n){this.statusCode=e,this.statusText=t,this.content=n}}(),We=function(){function e(){}return e.prototype.get=function(e,t){return this.send(Oe({},t,{method:"GET",url:e}))},e.prototype.post=function(e,t){return this.send(Oe({},t,{method:"POST",url:e}))},e.prototype.delete=function(e,t){return this.send(Oe({},t,{method:"DELETE",url:e}))},e.prototype.getCookieString=function(e){return""},e}();!function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Information=2]="Information",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Critical=5]="Critical",e[e.None=6]="None"}(Ee||(Ee={}));var Me,Ae=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qe=function(e){function t(t){var n=e.call(this)||this;return n.logger=t,n}return Ae(t,e),t.prototype.send=function(e){var t=this;return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new je):e.method?e.url?new Promise(function(n,r){var o=new XMLHttpRequest;o.open(e.method,e.url,!0),o.withCredentials=!0,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8");var i=e.headers;i&&Object.keys(i).forEach(function(e){o.setRequestHeader(e,i[e])}),e.responseType&&(o.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=function(){o.abort(),r(new je)}),e.timeout&&(o.timeout=e.timeout),o.onload=function(){e.abortSignal&&(e.abortSignal.onabort=null),o.status>=200&&o.status<300?n(new Ne(o.status,o.statusText,o.response||o.responseText)):r(new _e(o.statusText,o.status))},o.onerror=function(){t.logger.log(Ee.Warning,"Error from HTTP request. "+o.status+": "+o.statusText+"."),r(new _e(o.statusText,o.status))},o.ontimeout=function(){t.logger.log(Ee.Warning,"Timeout from HTTP request."),r(new Re)},o.send(e.content||"")}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},t}(We),He=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();if("undefined"==typeof XMLHttpRequest){var Ue="function"==typeof __webpack_require__?__non_webpack_require__:require;Me=Ue("./NodeHttpClient")}var Le=function(e){function t(t){var n=e.call(this)||this;if("undefined"!=typeof XMLHttpRequest)n.httpClient=new qe(t);else{if(void 0===Me)throw new Error("No HttpClient could be created.");n.httpClient=new Me.NodeHttpClient(t)}return n}return He(t,e),t.prototype.send=function(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new je):e.method?e.url?this.httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))},t.prototype.getCookieString=function(e){return this.httpClient.getCookieString(e)},t}(We),Fe=function(){function e(){}return e.write=function(t){return""+t+e.RecordSeparator},e.parse=function(t){if(t[t.length-1]!==e.RecordSeparator)throw new Error("Message is incomplete.");var n=t.split(e.RecordSeparator);return n.pop(),n},e.RecordSeparatorCode=30,e.RecordSeparator=String.fromCharCode(e.RecordSeparatorCode),e}(),De=function(){function e(){}return e.prototype.log=function(e,t){},e.instance=new e,e}(),Ge=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,c)}a((r=r.apply(e,t||[])).next())})},Be=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},Ke=function(){function e(){}return e.isRequired=function(e,t){if(null==e)throw new Error("The '"+t+"' argument is required.")},e.isIn=function(e,t,n){if(!(e in t))throw new Error("Unknown "+n+" value: "+e+".")},e}();function Je(e,t){var n="";return ze(e)?(n="Binary data of length "+e.byteLength,t&&(n+=". Content: '"+function(e){var t=new Uint8Array(e),n="";return t.forEach(function(e){n+="0x"+(e<16?"0":"")+e.toString(16)+" "}),n.substr(0,n.length-1)}(e)+"'")):"string"==typeof e&&(n="String data of length "+e.length,t&&(n+=". Content: '"+e+"'")),n}function ze(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function Xe(e,t,n,r,o,i,s){return Ge(this,void 0,void 0,function(){var c,a,u,l,h;return Be(this,function(p){switch(p.label){case 0:return o?[4,o()]:[3,2];case 1:(u=p.sent())&&((c={}).Authorization="Bearer "+u,a=c),p.label=2;case 2:return e.log(Ee.Trace,"("+t+" transport) sending data. "+Je(i,s)+"."),l=ze(i)?"arraybuffer":"text",[4,n.post(r,{content:i,headers:a,responseType:l})];case 3:return h=p.sent(),e.log(Ee.Trace,"("+t+" transport) request complete. Response status: "+h.statusCode+"."),[2]}})})}var Ye,Ve=function(){function e(e){this.observers=[],this.cancelCallback=e}return e.prototype.next=function(e){for(var t=0,n=this.observers;t<n.length;t++){n[t].next(e)}},e.prototype.error=function(e){for(var t=0,n=this.observers;t<n.length;t++){var r=n[t];r.error&&r.error(e)}},e.prototype.complete=function(){for(var e=0,t=this.observers;e<t.length;e++){var n=t[e];n.complete&&n.complete()}},e.prototype.subscribe=function(e){return this.observers.push(e),new Qe(this,e)},e}(),Qe=function(){function e(e,t){this.subject=e,this.observer=t}return e.prototype.dispose=function(){var e=this.subject.observers.indexOf(this.observer);e>-1&&this.subject.observers.splice(e,1),0===this.subject.observers.length&&this.subject.cancelCallback().catch(function(e){})},e}(),Ze=function(){function e(e){this.minimumLogLevel=e}return e.prototype.log=function(e,t){if(e>=this.minimumLogLevel)switch(e){case Ee.Critical:case Ee.Error:console.error("["+(new Date).toISOString()+"] "+Ee[e]+": "+t);break;case Ee.Warning:console.warn("["+(new Date).toISOString()+"] "+Ee[e]+": "+t);break;case Ee.Information:console.info("["+(new Date).toISOString()+"] "+Ee[e]+": "+t);break;default:console.log("["+(new Date).toISOString()+"] "+Ee[e]+": "+t)}},e}(),et=function(){function e(){}return e.prototype.writeHandshakeRequest=function(e){return Fe.write(JSON.stringify(e))},e.prototype.parseHandshakeResponse=function(e){var t,n;if(ze(e)||"undefined"!=typeof Buffer&&e instanceof Buffer){var r=new Uint8Array(e);if(-1===(i=r.indexOf(Fe.RecordSeparatorCode)))throw new Error("Message is incomplete.");var o=i+1;t=String.fromCharCode.apply(null,r.slice(0,o)),n=r.byteLength>o?r.slice(o).buffer:null}else{var i,s=e;if(-1===(i=s.indexOf(Fe.RecordSeparator)))throw new Error("Message is incomplete.");o=i+1;t=s.substring(0,o),n=s.length>o?s.substring(o):null}var c=Fe.parse(t),a=JSON.parse(c[0]);if(a.type)throw new Error("Expected a handshake response from the server.");return[n,a]},e}();!function(e){e[e.Invocation=1]="Invocation",e[e.StreamItem=2]="StreamItem",e[e.Completion=3]="Completion",e[e.StreamInvocation=4]="StreamInvocation",e[e.CancelInvocation=5]="CancelInvocation",e[e.Ping=6]="Ping",e[e.Close=7]="Close"}(Ye||(Ye={}));var tt,nt=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,c)}a((r=r.apply(e,t||[])).next())})},rt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},ot=3e4,it=15e3;!function(e){e[e.Disconnected=0]="Disconnected",e[e.Connected=1]="Connected"}(tt||(tt={}));var st,ct,at=function(){function e(e,t,n){var r=this;Ke.isRequired(e,"connection"),Ke.isRequired(t,"logger"),Ke.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=ot,this.keepAliveIntervalInMilliseconds=it,this.logger=t,this.protocol=n,this.connection=e,this.handshakeProtocol=new et,this.connection.onreceive=function(e){return r.processIncomingData(e)},this.connection.onclose=function(e){return r.connectionClosed(e)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.id=0,this.receivedHandshakeResponse=!1,this.connectionState=tt.Disconnected,this.cachedPingMessage=this.protocol.writeMessage({type:Ye.Ping})}return e.create=function(t,n,r){return new e(t,n,r)},Object.defineProperty(e.prototype,"state",{get:function(){return this.connectionState},enumerable:!0,configurable:!0}),e.prototype.start=function(){return nt(this,void 0,void 0,function(){var e,t,n=this;return rt(this,function(r){switch(r.label){case 0:return e={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(Ee.Debug,"Starting HubConnection."),this.receivedHandshakeResponse=!1,t=new Promise(function(e,t){n.handshakeResolver=e,n.handshakeRejecter=t}),[4,this.connection.start(this.protocol.transferFormat)];case 1:return r.sent(),this.logger.log(Ee.Debug,"Sending handshake request."),[4,this.sendMessage(this.handshakeProtocol.writeHandshakeRequest(e))];case 2:return r.sent(),this.logger.log(Ee.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.resetTimeoutPeriod(),this.resetKeepAliveInterval(),[4,t];case 3:return r.sent(),this.connectionState=tt.Connected,[2]}})})},e.prototype.stop=function(){return this.logger.log(Ee.Debug,"Stopping HubConnection."),this.cleanupTimeout(),this.cleanupPingTimer(),this.connection.stop()},e.prototype.stream=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.createStreamInvocation(e,n),i=new Ve(function(){var e=t.createCancelInvocation(o.invocationId),n=t.protocol.writeMessage(e);return delete t.callbacks[o.invocationId],t.sendMessage(n)});this.callbacks[o.invocationId]=function(e,t){t?i.error(t):e&&(e.type===Ye.Completion?e.error?i.error(new Error(e.error)):i.complete():i.next(e.item))};var s=this.protocol.writeMessage(o);return this.sendMessage(s).catch(function(e){i.error(e),delete t.callbacks[o.invocationId]}),i},e.prototype.sendMessage=function(e){return this.resetKeepAliveInterval(),this.connection.send(e)},e.prototype.send=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=this.createInvocation(e,t,!0),o=this.protocol.writeMessage(r);return this.sendMessage(o)},e.prototype.invoke=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.createInvocation(e,n,!1);return new Promise(function(e,n){t.callbacks[o.invocationId]=function(t,r){r?n(r):t&&(t.type===Ye.Completion?t.error?n(new Error(t.error)):e(t.result):n(new Error("Unexpected message type: "+t.type)))};var r=t.protocol.writeMessage(o);t.sendMessage(r).catch(function(e){n(e),delete t.callbacks[o.invocationId]})})},e.prototype.on=function(e,t){e&&t&&(e=e.toLowerCase(),this.methods[e]||(this.methods[e]=[]),-1===this.methods[e].indexOf(t)&&this.methods[e].push(t))},e.prototype.off=function(e,t){if(e){e=e.toLowerCase();var n=this.methods[e];if(n)if(t){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.methods[e])}else delete this.methods[e]}},e.prototype.onclose=function(e){e&&this.closedCallbacks.push(e)},e.prototype.processIncomingData=function(e){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(e=this.processHandshakeResponse(e),this.receivedHandshakeResponse=!0),e)for(var t=0,n=this.protocol.parseMessages(e,this.logger);t<n.length;t++){var r=n[t];switch(r.type){case Ye.Invocation:this.invokeClientMethod(r);break;case Ye.StreamItem:case Ye.Completion:var o=this.callbacks[r.invocationId];null!=o&&(r.type===Ye.Completion&&delete this.callbacks[r.invocationId],o(r));break;case Ye.Ping:break;case Ye.Close:this.logger.log(Ee.Information,"Close message received from server."),this.connection.stop(r.error?new Error("Server returned an error on close: "+r.error):void 0);break;default:this.logger.log(Ee.Warning,"Invalid message type: "+r.type+".")}}this.resetTimeoutPeriod()},e.prototype.processHandshakeResponse=function(e){var t,n,r;try{r=(t=this.handshakeProtocol.parseHandshakeResponse(e))[0],n=t[1]}catch(e){var o="Error parsing handshake response: "+e;this.logger.log(Ee.Error,o);var i=new Error(o);throw this.connection.stop(i),this.handshakeRejecter(i),i}if(n.error){o="Server returned handshake error: "+n.error;throw this.logger.log(Ee.Error,o),this.handshakeRejecter(o),this.connection.stop(new Error(o)),new Error(o)}return this.logger.log(Ee.Debug,"Server handshake complete."),this.handshakeResolver(),r},e.prototype.resetKeepAliveInterval=function(){var e=this;this.cleanupPingTimer(),this.pingServerHandle=setTimeout(function(){return nt(e,void 0,void 0,function(){return rt(this,function(e){switch(e.label){case 0:if(this.connectionState!==tt.Connected)return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.sendMessage(this.cachedPingMessage)];case 2:return e.sent(),[3,4];case 3:return e.sent(),this.cleanupPingTimer(),[3,4];case 4:return[2]}})})},this.keepAliveIntervalInMilliseconds)},e.prototype.resetTimeoutPeriod=function(){var e=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return e.serverTimeout()},this.serverTimeoutInMilliseconds))},e.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},e.prototype.invokeClientMethod=function(e){var t=this,n=this.methods[e.target.toLowerCase()];if(n){if(n.forEach(function(n){return n.apply(t,e.arguments)}),e.invocationId){var r="Server requested a response, which is not supported in this version of the client.";this.logger.log(Ee.Error,r),this.connection.stop(new Error(r))}}else this.logger.log(Ee.Warning,"No client method with the name '"+e.target+"' found.")},e.prototype.connectionClosed=function(e){var t=this,n=this.callbacks;this.callbacks={},this.connectionState=tt.Disconnected,this.handshakeRejecter&&this.handshakeRejecter(e),Object.keys(n).forEach(function(t){(0,n[t])(null,e||new Error("Invocation canceled due to connection being closed."))}),this.cleanupTimeout(),this.cleanupPingTimer(),this.closedCallbacks.forEach(function(n){return n.apply(t,[e])})},e.prototype.cleanupPingTimer=function(){this.pingServerHandle&&clearTimeout(this.pingServerHandle)},e.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},e.prototype.createInvocation=function(e,t,n){if(n)return{arguments:t,target:e,type:Ye.Invocation};var r=this.id;return this.id++,{arguments:t,invocationId:r.toString(),target:e,type:Ye.Invocation}},e.prototype.createStreamInvocation=function(e,t){var n=this.id;return this.id++,{arguments:t,invocationId:n.toString(),target:e,type:Ye.StreamInvocation}},e.prototype.createCancelInvocation=function(e){return{invocationId:e,type:Ye.CancelInvocation}},e}();!function(e){e[e.None=0]="None",e[e.WebSockets=1]="WebSockets",e[e.ServerSentEvents=2]="ServerSentEvents",e[e.LongPolling=4]="LongPolling"}(st||(st={})),function(e){e[e.Text=1]="Text",e[e.Binary=2]="Binary"}(ct||(ct={}));var ut=function(){function e(){this.isAborted=!1,this.onabort=null}return e.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(e.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),e}(),lt=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,c)}a((r=r.apply(e,t||[])).next())})},ht=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},pt=function(){function e(e,t,n,r){this.httpClient=e,this.accessTokenFactory=t,this.logger=n,this.pollAbort=new ut,this.logMessageContent=r,this.running=!1,this.onreceive=null,this.onclose=null}return Object.defineProperty(e.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),e.prototype.connect=function(e,t){return lt(this,void 0,void 0,function(){var n,r,o,i;return ht(this,function(s){switch(s.label){case 0:if(Ke.isRequired(e,"url"),Ke.isRequired(t,"transferFormat"),Ke.isIn(t,ct,"transferFormat"),this.url=e,this.logger.log(Ee.Trace,"(LongPolling transport) Connecting."),t===ct.Binary&&"undefined"!=typeof XMLHttpRequest&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return n={abortSignal:this.pollAbort.signal,headers:{},timeout:1e5},t===ct.Binary&&(n.responseType="arraybuffer"),[4,this.getAccessToken()];case 1:return r=s.sent(),this.updateHeaderToken(n,r),o=e+"&_="+Date.now(),this.logger.log(Ee.Trace,"(LongPolling transport) polling: "+o+"."),[4,this.httpClient.get(o,n)];case 2:return 200!==(i=s.sent()).statusCode?(this.logger.log(Ee.Error,"(LongPolling transport) Unexpected response code: "+i.statusCode+"."),this.closeError=new _e(i.statusText||"",i.statusCode),this.running=!1):this.running=!0,this.receiving=this.poll(this.url,n),[2]}})})},e.prototype.getAccessToken=function(){return lt(this,void 0,void 0,function(){return ht(this,function(e){switch(e.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,null]}})})},e.prototype.updateHeaderToken=function(e,t){e.headers||(e.headers={}),t?e.headers.Authorization="Bearer "+t:e.headers.Authorization&&delete e.headers.Authorization},e.prototype.poll=function(e,t){return lt(this,void 0,void 0,function(){var n,r,o,i;return ht(this,function(s){switch(s.label){case 0:s.trys.push([0,,8,9]),s.label=1;case 1:return this.running?[4,this.getAccessToken()]:[3,7];case 2:n=s.sent(),this.updateHeaderToken(t,n),s.label=3;case 3:return s.trys.push([3,5,,6]),r=e+"&_="+Date.now(),this.logger.log(Ee.Trace,"(LongPolling transport) polling: "+r+"."),[4,this.httpClient.get(r,t)];case 4:return 204===(o=s.sent()).statusCode?(this.logger.log(Ee.Information,"(LongPolling transport) Poll terminated by server."),this.running=!1):200!==o.statusCode?(this.logger.log(Ee.Error,"(LongPolling transport) Unexpected response code: "+o.statusCode+"."),this.closeError=new _e(o.statusText||"",o.statusCode),this.running=!1):o.content?(this.logger.log(Ee.Trace,"(LongPolling transport) data received. "+Je(o.content,this.logMessageContent)+"."),this.onreceive&&this.onreceive(o.content)):this.logger.log(Ee.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return i=s.sent(),this.running?i instanceof Re?this.logger.log(Ee.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this.closeError=i,this.running=!1):this.logger.log(Ee.Trace,"(LongPolling transport) Poll errored after shutdown: "+i.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.logger.log(Ee.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this.raiseOnClose(),[7];case 9:return[2]}})})},e.prototype.send=function(e){return lt(this,void 0,void 0,function(){return ht(this,function(t){return this.running?[2,Xe(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,e,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},e.prototype.stop=function(){return lt(this,void 0,void 0,function(){var e,t;return ht(this,function(n){switch(n.label){case 0:this.logger.log(Ee.Trace,"(LongPolling transport) Stopping polling."),this.running=!1,this.pollAbort.abort(),n.label=1;case 1:return n.trys.push([1,,5,6]),[4,this.receiving];case 2:return n.sent(),this.logger.log(Ee.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),e={headers:{}},[4,this.getAccessToken()];case 3:return t=n.sent(),this.updateHeaderToken(e,t),[4,this.httpClient.delete(this.url,e)];case 4:return n.sent(),this.logger.log(Ee.Trace,"(LongPolling transport) DELETE request sent."),[3,6];case 5:return this.logger.log(Ee.Trace,"(LongPolling transport) Stop finished."),this.raiseOnClose(),[7];case 6:return[2]}})})},e.prototype.raiseOnClose=function(){if(this.onclose){var e="(LongPolling transport) Firing onclose event.";this.closeError&&(e+=" Error: "+this.closeError),this.logger.log(Ee.Trace,e),this.onclose(this.closeError)}},e}(),ft=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,c)}a((r=r.apply(e,t||[])).next())})},gt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},dt=function(){function e(e,t,n,r,o){this.httpClient=e,this.accessTokenFactory=t,this.logger=n,this.logMessageContent=r,this.eventSourceConstructor=o,this.onreceive=null,this.onclose=null}return e.prototype.connect=function(e,t){return ft(this,void 0,void 0,function(){var n,r=this;return gt(this,function(o){switch(o.label){case 0:return Ke.isRequired(e,"url"),Ke.isRequired(t,"transferFormat"),Ke.isIn(t,ct,"transferFormat"),this.logger.log(Ee.Trace,"(SSE transport) Connecting."),this.url=e,this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=o.sent())&&(e+=(e.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),o.label=2;case 2:return[2,new Promise(function(n,o){var i=!1;if(t===ct.Text){var s;if("undefined"!=typeof window)s=new r.eventSourceConstructor(e,{withCredentials:!0});else{var c=r.httpClient.getCookieString(e);s=new r.eventSourceConstructor(e,{withCredentials:!0,headers:{Cookie:c}})}try{s.onmessage=function(e){if(r.onreceive)try{r.logger.log(Ee.Trace,"(SSE transport) data received. "+Je(e.data,r.logMessageContent)+"."),r.onreceive(e.data)}catch(e){return void r.close(e)}},s.onerror=function(e){var t=new Error(e.data||"Error occurred");i?r.close(t):o(t)},s.onopen=function(){r.logger.log(Ee.Information,"SSE connected to "+r.url),r.eventSource=s,i=!0,n()}}catch(e){return void o(e)}}else o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})]}})})},e.prototype.send=function(e){return ft(this,void 0,void 0,function(){return gt(this,function(t){return this.eventSource?[2,Xe(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,e,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},e.prototype.stop=function(){return this.close(),Promise.resolve()},e.prototype.close=function(e){this.eventSource&&(this.eventSource.close(),this.eventSource=void 0,this.onclose&&this.onclose(e))},e}(),mt=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,c)}a((r=r.apply(e,t||[])).next())})},vt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},bt=function(){function e(e,t,n,r,o){this.logger=n,this.accessTokenFactory=t,this.logMessageContent=r,this.webSocketConstructor=o,this.httpClient=e,this.onreceive=null,this.onclose=null}return e.prototype.connect=function(e,t){return mt(this,void 0,void 0,function(){var n,r=this;return vt(this,function(o){switch(o.label){case 0:return Ke.isRequired(e,"url"),Ke.isRequired(t,"transferFormat"),Ke.isIn(t,ct,"transferFormat"),this.logger.log(Ee.Trace,"(WebSockets transport) Connecting."),this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(n=o.sent())&&(e+=(e.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(n)),o.label=2;case 2:return[2,new Promise(function(n,o){var i;e=e.replace(/^http/,"ws");var s=r.httpClient.getCookieString(e);"undefined"==typeof window&&s&&(i=new r.webSocketConstructor(e,void 0,{headers:{Cookie:""+s}})),i||(i=new r.webSocketConstructor(e)),t===ct.Binary&&(i.binaryType="arraybuffer"),i.onopen=function(t){r.logger.log(Ee.Information,"WebSocket connected to "+e+"."),r.webSocket=i,n()},i.onerror=function(e){var t=null;"undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent&&(t=e.error),o(t)},i.onmessage=function(e){r.logger.log(Ee.Trace,"(WebSockets transport) data received. "+Je(e.data,r.logMessageContent)+"."),r.onreceive&&r.onreceive(e.data)},i.onclose=function(e){return r.close(e)}})]}})})},e.prototype.send=function(e){return this.webSocket&&this.webSocket.readyState===this.webSocketConstructor.OPEN?(this.logger.log(Ee.Trace,"(WebSockets transport) sending data. "+Je(e,this.logMessageContent)+"."),this.webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},e.prototype.stop=function(){return this.webSocket&&(this.webSocket.onclose=function(){},this.webSocket.onmessage=function(){},this.webSocket.onerror=function(){},this.webSocket.close(),this.webSocket=void 0,this.close(void 0)),Promise.resolve()},e.prototype.close=function(e){this.logger.log(Ee.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!e||!1!==e.wasClean&&1e3===e.code?this.onclose():this.onclose(new Error("WebSocket closed with status code: "+e.code+" ("+e.reason+").")))},e}(),yt=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,c)}a((r=r.apply(e,t||[])).next())})},wt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},St=null,xt=null;if("undefined"==typeof window&&"undefined"!=typeof require){var Tt="function"==typeof __webpack_require__?__non_webpack_require__:require;St=Tt("ws"),xt=Tt("eventsource")}var kt=function(){function e(e,t){var n;void 0===t&&(t={}),this.features={},Ke.isRequired(e,"url"),this.logger=void 0===(n=t.logger)?new Ze(Ee.Information):null===n?De.instance:n.log?n:new Ze(n),this.baseUrl=this.resolveUrl(e),(t=t||{}).logMessageContent=t.logMessageContent||!1;var r="undefined"==typeof window;r||"undefined"==typeof WebSocket||t.WebSocket?r&&!t.WebSocket&&St&&(t.WebSocket=St):t.WebSocket=WebSocket,r||"undefined"==typeof EventSource||t.EventSource?r&&!t.EventSource&&void 0!==xt&&(t.EventSource=xt):t.EventSource=EventSource,this.httpClient=t.httpClient||new Le(this.logger),this.connectionState=2,this.options=t,this.onreceive=null,this.onclose=null}return e.prototype.start=function(e){return e=e||ct.Binary,Ke.isIn(e,ct,"transferFormat"),this.logger.log(Ee.Debug,"Starting connection with transfer format '"+ct[e]+"'."),2!==this.connectionState?Promise.reject(new Error("Cannot start a connection that is not in the 'Disconnected' state.")):(this.connectionState=0,this.startPromise=this.startInternal(e),this.startPromise)},e.prototype.send=function(e){if(1!==this.connectionState)throw new Error("Cannot send data if the connection is not in the 'Connected' State.");return this.transport.send(e)},e.prototype.stop=function(e){return yt(this,void 0,void 0,function(){return wt(this,function(t){switch(t.label){case 0:this.connectionState=2,this.stopError=e,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.startPromise];case 2:return t.sent(),[3,4];case 3:return t.sent(),[3,4];case 4:return this.transport?[4,this.transport.stop()]:[3,6];case 5:t.sent(),this.transport=void 0,t.label=6;case 6:return[2]}})})},e.prototype.startInternal=function(e){return yt(this,void 0,void 0,function(){var t,n,r,o,i,s,c,a=this;return wt(this,function(u){switch(u.label){case 0:t=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,u.label=1;case 1:return u.trys.push([1,12,,13]),this.options.skipNegotiation?this.options.transport!==st.WebSockets?[3,3]:(this.transport=this.constructTransport(st.WebSockets),[4,this.transport.connect(t,e)]):[3,5];case 2:return u.sent(),[3,4];case 3:throw Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:n=null,r=0,o=function(){var e;return wt(this,function(o){switch(o.label){case 0:return[4,i.getNegotiationResponse(t)];case 1:if(n=o.sent(),2===i.connectionState)return[2,{value:void 0}];if(n.error)throw Error(n.error);if(n.ProtocolVersion)throw Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");return n.url&&(t=n.url),n.accessToken&&(e=n.accessToken,i.accessTokenFactory=function(){return e}),r++,[2]}})},i=this,u.label=6;case 6:return[5,o()];case 7:if("object"==typeof(s=u.sent()))return[2,s.value];u.label=8;case 8:if(n.url&&r<100)return[3,6];u.label=9;case 9:if(100===r&&n.url)throw Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(t,this.options.transport,n,e)];case 10:u.sent(),u.label=11;case 11:return this.transport instanceof pt&&(this.features.inherentKeepAlive=!0),this.transport.onreceive=this.onreceive,this.transport.onclose=function(e){return a.stopConnection(e)},this.changeState(0,1),[3,13];case 12:throw c=u.sent(),this.logger.log(Ee.Error,"Failed to start the connection: "+c),this.connectionState=2,this.transport=void 0,c;case 13:return[2]}})})},e.prototype.getNegotiationResponse=function(e){return yt(this,void 0,void 0,function(){var t,n,r,o,i,s;return wt(this,function(c){switch(c.label){case 0:return this.accessTokenFactory?[4,this.accessTokenFactory()]:[3,2];case 1:(r=c.sent())&&((t={}).Authorization="Bearer "+r,n=t),c.label=2;case 2:o=this.resolveNegotiateUrl(e),this.logger.log(Ee.Debug,"Sending negotiation request: "+o+"."),c.label=3;case 3:return c.trys.push([3,5,,6]),[4,this.httpClient.post(o,{content:"",headers:n})];case 4:if(200!==(i=c.sent()).statusCode)throw Error("Unexpected status code returned from negotiate "+i.statusCode);return[2,JSON.parse(i.content)];case 5:throw s=c.sent(),this.logger.log(Ee.Error,"Failed to complete negotiation with the server: "+s),s;case 6:return[2]}})})},e.prototype.createConnectUrl=function(e,t){return t?e+(-1===e.indexOf("?")?"?":"&")+"id="+t:e},e.prototype.createTransport=function(e,t,n,r){return yt(this,void 0,void 0,function(){var o,i,s,c,a,u,l;return wt(this,function(h){switch(h.label){case 0:return o=this.createConnectUrl(e,n.connectionId),this.isITransport(t)?(this.logger.log(Ee.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,[4,this.transport.connect(o,r)]):[3,2];case 1:return h.sent(),this.changeState(0,1),[2];case 2:i=n.availableTransports||[],s=0,c=i,h.label=3;case 3:return s<c.length?(a=c[s],this.connectionState=0,"number"!=typeof(u=this.resolveTransport(a,t,r))?[3,8]:(this.transport=this.constructTransport(u),n.connectionId?[3,5]:[4,this.getNegotiationResponse(e)])):[3,9];case 4:n=h.sent(),o=this.createConnectUrl(e,n.connectionId),h.label=5;case 5:return h.trys.push([5,7,,8]),[4,this.transport.connect(o,r)];case 6:return h.sent(),this.changeState(0,1),[2];case 7:return l=h.sent(),this.logger.log(Ee.Error,"Failed to start the transport '"+st[u]+"': "+l),this.connectionState=2,n.connectionId=void 0,[3,8];case 8:return s++,[3,3];case 9:throw new Error("Unable to initialize any of the available transports.")}})})},e.prototype.constructTransport=function(e){switch(e){case st.WebSockets:if(!this.options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new bt(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.WebSocket);case st.ServerSentEvents:if(!this.options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new dt(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1,this.options.EventSource);case st.LongPolling:return new pt(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent||!1);default:throw new Error("Unknown transport: "+e+".")}},e.prototype.resolveTransport=function(e,t,n){var r=st[e.transport];if(null==r)this.logger.log(Ee.Debug,"Skipping transport '"+e.transport+"' because it is not supported by this client.");else{var o=e.transferFormats.map(function(e){return ct[e]});if(function(e,t){return!e||0!=(t&e)}(t,r))if(o.indexOf(n)>=0){if((r!==st.WebSockets||this.options.WebSocket)&&(r!==st.ServerSentEvents||this.options.EventSource))return this.logger.log(Ee.Debug,"Selecting transport '"+st[r]+"'."),r;this.logger.log(Ee.Debug,"Skipping transport '"+st[r]+"' because it is not supported in your environment.'")}else this.logger.log(Ee.Debug,"Skipping transport '"+st[r]+"' because it does not support the requested transfer format '"+ct[n]+"'.");else this.logger.log(Ee.Debug,"Skipping transport '"+st[r]+"' because it was disabled by the client.")}return null},e.prototype.isITransport=function(e){return e&&"object"==typeof e&&"connect"in e},e.prototype.changeState=function(e,t){return this.connectionState===e&&(this.connectionState=t,!0)},e.prototype.stopConnection=function(e){this.transport=void 0,(e=this.stopError||e)?this.logger.log(Ee.Error,"Connection disconnected with error '"+e+"'."):this.logger.log(Ee.Information,"Connection disconnected."),this.connectionState=2,this.onclose&&this.onclose(e)},e.prototype.resolveUrl=function(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;if("undefined"==typeof window||!window||!window.document)throw new Error("Cannot resolve '"+e+"'.");var t=window.document.createElement("a");return t.href=e,this.logger.log(Ee.Information,"Normalizing '"+e+"' to '"+t.href+"'."),t.href},e.prototype.resolveNegotiateUrl=function(e){var t=e.indexOf("?"),n=e.substring(0,-1===t?e.length:t);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",n+=-1===t?"":e.substring(t)},e}();var $t="json",Ct=function(){function e(){this.name=$t,this.version=1,this.transferFormat=ct.Text}return e.prototype.parseMessages=function(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=De.instance);for(var n=[],r=0,o=Fe.parse(e);r<o.length;r++){var i=o[r],s=JSON.parse(i);if("number"!=typeof s.type)throw new Error("Invalid payload.");switch(s.type){case Ye.Invocation:this.isInvocationMessage(s);break;case Ye.StreamItem:this.isStreamItemMessage(s);break;case Ye.Completion:this.isCompletionMessage(s);break;case Ye.Ping:case Ye.Close:break;default:t.log(Ee.Information,"Unknown message type '"+s.type+"' ignored.");continue}n.push(s)}return n},e.prototype.writeMessage=function(e){return Fe.write(JSON.stringify(e))},e.prototype.isInvocationMessage=function(e){this.assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this.assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")},e.prototype.isStreamItemMessage=function(e){if(this.assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")},e.prototype.isCompletionMessage=function(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.assertNotEmptyString(e.error,"Invalid payload for Completion message."),this.assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")},e.prototype.assertNotEmptyString=function(e,t){if("string"!=typeof e||""===e)throw new Error(t)},e}(),Pt=function(){function e(){}return e.prototype.configureLogging=function(e){return Ke.isRequired(e,"logging"),void 0!==e.log?this.logger=e:this.logger=new Ze(e),this},e.prototype.withUrl=function(e,t){return Ke.isRequired(e,"url"),this.url=e,this.httpConnectionOptions="object"==typeof t?t:{transport:t},this},e.prototype.withHubProtocol=function(e){return Ke.isRequired(e,"protocol"),this.protocol=e,this},e.prototype.build=function(){var e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");var t=new kt(this.url,e);return at.create(t,this.logger||De.instance,this.protocol||new Ct)},e}();const Et=-1!==window.location.href.indexOf("localhost")?"localhost:8888":"46.101.48.35",It=(new Pt).withUrl(`http://${Et}/raceHub`).configureLogging(Ee.Information).build();window.g_connection=It;const _t={0:"connecting",1:"connected",2:"reconnecting",4:"disconnected"};let Rt,jt="",Ot=void 0,Nt="",Wt=0,Mt=!1;const At=window.location.hash.split("=")[1];async function qt(){try{await It.start(),console.log("Successfully connected to hub")}catch(e){console.log(e),console.log("Retrying in 5 seconds"),(Wt+=1)<10&&setTimeout(()=>qt(),5e3)}}async function Ht(){let e=0;for(;"connected"!==_t[It.connectionState]&&e<15;)await Ut(.2+.5*e),console.log("tryingtoconnect"),e++;return It}async function Ut(e){return new Promise((t,n)=>{setTimeout(t,1e3*e)})}function Lt(e,t,n,r){t&&function(e,t){fe.update(n=>(n[e]=t,n))}(e,t),r&&function(e,t){console.log(`${t} Setting users ${e} start time to `),console.log(`${Ot} My start time`),ge.update(n=>(n[e]=t,n))}(e,r),void 0===n&&(ge.update(t=>(delete t[e],t)),console.log(`removed user time: ${e}`)),pe.update(t=>(n?t[e]=n:delete t[e],t))}if(0===window.location.hash.indexOf("#race")){Nt=function(){let e=sessionStorage?sessionStorage.getItem("name"):"";return e||(e=prompt("What is your name?"),sessionStorage&&sessionStorage.setItem("name",e)),e}();const e=Ht().then(e=>{e.invoke("joinGroup",At,Nt,`${Ot}`)});Rt=new Ce({target:document.body,props:{signalrConnection:Ht,racingGroup:At,myId:"me",joinRaceGroup:e,masterStatus:Mt}})}else Rt=new re({target:document.body});return It.onclose(async()=>{await qt()}),It.on("UserDisconnected",function(e){console.log(`UserDisconnected: ${e}`)}),It.on("ReceiveMessage",function(e){console.log(`Received message: ${e}`)}),It.on("YouAre",e=>{jt=e;const t=new Date;Ot=`${t.getTime()}-${t.getUTCMilliseconds()}-${Math.random()}`,Lt(e,Nt,{id:e,progress:0,name:Nt},Ot),Rt.myId&&Rt.$set({myId:jt}),console.log(`YouAre: ${e}`),setTimeout(()=>{ge.subscribe(e=>{let t=!0;for(let n in e)console.log(n,e[n]),console.log(`${n} !== ${jt} && ${e[n]} < ${Ot} = ${e[n]<Ot}`),n!==jt&&e[n]<Ot&&(t=!1);Mt!==t&&function(e){Mt=e,Rt.$set({masterStatus:Mt})}(t)})},3e3)}),It.on("UserJoined",(e,t,n)=>{Lt(e,t,{id:e,progress:0},n),jt&&Ht().then(t=>t.invoke("CallUser",e,"ImHere",JSON.stringify({userId:jt,username:Nt,startTime:Ot}))),console.log(`User: ${e} ${t} ${n} joined`)}),It.on("UserLeft",e=>{Lt(e,void 0,void 0),console.log(`User: ${e} left`)}),It.on("ImHere",e=>{let{userId:t,username:n,startTime:r}=JSON.parse(e);Lt(t,n,{id:t,progress:0},r),console.log(`User: ${t} ${n} ${e} says hello`)}),It.on("UserProgress",(e,t)=>{Lt(e,void 0,{id:e,progress:t}),console.log(`User: ${e} joined`)}),qt(),Rt}();
//# sourceMappingURL=bundle.js.map
